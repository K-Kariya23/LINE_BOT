# -*- coding: utf-8 -*-
"""LINE_Mahjong.ipynb

Automatically generated by Colaboratory.

Original file is located at
    ***
"""



from flask import Flask, request, abort
from linebot import LineBotApi, WebhookHandler 
from linebot.exceptions import InvalidSignatureError 
from linebot.models import MessageEvent, TextMessage, TextSendMessage 
import pya3rt 

app=Flask(__name__)

line_bot_api=LineBotApi("***")
handler=WebhookHandler("***")

@app.route("/callback", methods=['POST'])
def call():
  signature=request.headers["X-Line-Signature"]
  body=request.get_data(as_text=True)

  try:
    handler.handle(body, signature)
  except InvalidSignatureError:
    abort(400)
  
  return 'OK'

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
  ai_message=talk_ai(event.message.text)
  line_bot_api.reply_message(event.reply_token,TextSendMessage(text=ai_message))

def talk_ai(word):
  apikey='***'
  client=pya3rt.TalkClient(apikey)
  #辞書から取り出すイメージ
  dict1={"子二20ツモ":"400/700",
        "子三20ツモ":"700/1300",
        "子四20ツモ":"1300/2600",
        "子二25ツモ":"役が存在しません. 七対子ツモであれば800/1600です",
        "子三25ツモ":"800/1600",
        "子四25ツモ":"1600/3200",
        "子一30ツモ":"300/500",
        "子二30ツモ":"500/1000",
        "子三30ツモ":"1000/2000",
        "子四30ツモ":"2000/3900",
        "子一40ツモ":"400/700",
        "子二40ツモ":"700/1300",
        "子三40ツモ":"1300/2600",
        "子一50ツモ":"400/800",
        "子二50ツモ":"800/1600",
        "子三50ツモ":"1600/3200",
        "子一60ツモ":"500/1000",
        "子二60ツモ":"1000/2000",
        "子三60ツモ":"2000/3900",
        "子一70ツモ":"600/1200",
        "子二70ツモ":"1200/2600",
        "子一80ツモ":"700/1300",
        "子二80ツモ":"1300/2600",
        "子一90ツモ":"800/1500",
        "子二90ツモ":"1500/2900",
        "子一100ツモ":"800/1600",
        "子二100ツモ":"1600/2300",
        "子一110ツモ":"900/1800",
        "子二110ツモ":"1800/3600",
        "子二20ロン":"役が存在しません.",
        "子三20ロン":"役が存在しません.",
        "子四20ロン":"役が存在しません.",
        "子二25ロン":"1600",
        "子三25ロン":"3200",
        "子四25ロン":"6400",
        "子一30ロン":"1000",
        "子二30ロン":"2000",
        "子三30ロン":"3900",
        "子四30ロン":"7700",
        "子一40ロン":"1300",
        "子二40ロン":"2600",
        "子三40ロン":"5200",
        "子一50ロン":"1800",
        "子二50ロン":"3200",
        "子三50ロン":"6400",
        "子一60ロン":"2000",
        "子二60ロン":"3900",
        "子三60ロン":"7700",
        "子一70ロン":"2300",
        "子二70ロン":"4500",
        "子一80ロン":"2600",
        "子二80ロン":"5200",
        "子一90ロン":"2900",
        "子二90ロン":"5800",
        "子一100ロン":"3200",
        "子二100ロン":"6400",
        "子一110ロン":"3600",
        "子二110ロン":"7100",
        "親二20ツモ":"700all",
        "親三20ツモ":"1300all",
        "親四20ツモ":"2600all",
        "親二25ツモ":"役が存在しません. 七対子ツモであれば800/1600です",
        "親三25ツモ":"1600all",
        "親四25ツモ":"3200all",
        "親一30ツモ":"500all",
        "親二30ツモ":"1000all",
        "親三30ツモ":"2000all",
        "親四30ツモ":"3900all",
        "親一40ツモ":"700all",
        "親二40ツモ":"1300all",
        "親三40ツモ":"2600all",
        "親一50ツモ":"800all",
        "親二50ツモ":"1600all",
        "親三50ツモ":"3200all",
        "親一60ツモ":"1000all",
        "親二60ツモ":"2000all",
        "親三60ツモ":"3900all",
        "親一70ツモ":"1200all",
        "親二70ツモ":"2600all",
        "親一80ツモ":"1300all",
        "親二80ツモ":"2600all",
        "親一90ツモ":"1500all",
        "親二90ツモ":"2900all",
        "親一100ツモ":"1600all",
        "親二100ツモ":"2300all",
        "親一110ツモ":"1800all",
        "親二110ツモ":"3600all",
        "親二20ロン":"役が存在しません.",
        "親三20ロン":"役が存在しません.",
        "親四20ロン":"役が存在しません.",
        "親二25ロン":"2400",
        "親三25ロン":"4800",
        "親四25ロン":"9600",
        "親一30ロン":"1500",
        "親二30ロン":"2900",
        "親三30ロン":"5800",
        "親四30ロン":"11600",
        "親一40ロン":"2000",
        "親二40ロン":"3900",
        "親三40ロン":"7700",
        "親一50ロン":"2400",
        "親二50ロン":"4800",
        "親三50ロン":"9600",
        "親一60ロン":"2900",
        "親二60ロン":"5800",
        "親三60ロン":"11600",
        "親一70ロン":"3400",
        "親二70ロン":"6800",
        "親一80ロン":"3900",
        "親二80ロン":"7700",
        "親一90ロン":"4400",
        "親二90ロン":"8700",
        "親一100ロン":"4800",
        "親二100ロン":"9600",
        "親一110ロン":"5300",
        "親二110ロン":"10600",
        }
  dict2={
      "子満貫ツモ":"2000/4000",
      "子跳満ツモ":"3000/6000",
      "子倍満ツモ":"4000/8000",
      "子三倍満ツモ":"6000/12000",
      "子役満ツモ":"8000/16000",
      "子満貫ロン":"8000",
      "子跳満ロン":"12000",
      "子倍満ロン":"18000",
      "子三倍満ロン":"24000",
      "子役満ロン":"36000",
      "親満貫ツモ":"4000all",
      "親跳満ツモ":"6000all",
      "親倍満ツモ":"8000all",
      "親三倍満ツモ":"12000all",
      "親役満ツモ":"16000all",
      "親満貫ロン":"12000",
      "親跳満ロン":"18000",
      "親倍満ロン":"24000",
      "親三倍満ロン":"36000",
      "親役満ロン":"48000",
  }

  list1=[
          "子四40ツモ",
          "子四50ツモ",
          "子四60ツモ",
          "子三70ツモ",
          "子四70ツモ",
          "子三80ツモ",
          "子四80ツモ",
          "子三90ツモ",
          "子四90ツモ",
          "子三100ツモ",
          "子四100ツモ",
          "子三110ツモ",
          "子四110ツモ",
  ]

  list2=[
          "子四40ロン",
          "子四50ロン",
          "子四60ロン",
          "子三70ロン",
          "子四70ロン",
          "子三80ロン",
          "子四80ロン",
          "子三90ロン",
          "子四90ロン",
          "子三100ロン",
          "子四100ロン",
          "子三110ロン",
          "子四110ロン",
  ]

  list3=[
          "親四40ツモ",
          "親四50ツモ",
          "親四60ツモ",
          "親三70ツモ",
          "親四70ツモ",
          "親三80ツモ",
          "親四80ツモ",
          "親三90ツモ",
          "親四90ツモ",
          "親三100ツモ",
          "親四100ツモ",
          "親三110ツモ",
          "親四110ツモ",
  ]

  list4=[
          "親四40ロン",
          "親四50ロン",
          "親四60ロン",
          "親三70ロン",
          "親四70ロン",
          "親三80ロン",
          "親四80ロン",
          "親三90ロン",
          "親四90ロン",
          "親三100ロン",
          "親四100ロン",
          "親三110ロン",
          "親四110ロン",
  ]

#通常→子ツモミス→子ロンミス→親ツモミス→親ロンミス→それ以外の入力
  if (word in dict1)==True:
    reply_message=dict1[word]
    return reply_message
  elif (word in dict2)==True:
    reply_message=dict2[word]
    return reply_message
  elif (word in list1)==True:
    reply_message=dict2["子満貫ツモ"]
    return reply_message
  elif (word in list2)==True:
    reply_message=dict2["子満貫ロン"]
    return reply_message
  elif (word in list3)==True:
    reply_message=dict2["親満貫ツモ"]
    return reply_message
  elif (word in list4)==True:
    reply_message=dict2["親満貫ロン"]
    return reply_message
  else:
    reply_message=client.talk(word)
    return reply_message['results'][0]['reply']

if __name__=='__main__':
  app.run()

